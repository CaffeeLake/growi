name: Node CI for app production

on:
  push:
    branches-ignore:
      - release/**
      - rc/**
      - chore/**
      - support/prepare-v**

jobs:

  test-prod-12.x:
    uses: weseek/growi/.github/workflows/reusable-app-prod.yml@support/vrt-with-cypress
    with:
      node-version: 12.x
      skip-cypress: true
    secrets:
      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}


  test-prod-14.x:
    uses: weseek/growi/.github/workflows/reusable-app-prod.yml@support/vrt-with-cypress
    with:
      node-version: 14.x
      cypress-report-artifact-name: Cypress report
    secrets:
      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}


  run-reg-suit-14.x:
    needs: [test-prod-14.x]

    uses: weseek/growi/.github/workflows/reusable-app-reg-suit.yml@support/vrt-with-cypress

    if: always()

    with:
      node-version: 14.x
      cypress-report-artifact-name: Cypress report
    secrets:
      REG_NOTIFY_GITHUB_PLUGIN_CLIENTID: ${{ secrets.REG_NOTIFY_GITHUB_PLUGIN_CLIENTID }}
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
